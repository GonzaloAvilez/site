
<html>
<body>

<script type="text/javascript">

Uize.require (
	[
		'UizeSite.Page.Example.library',
		'UizeSite.Page.Example',
		'Uize.Widget.Drag',
		'Uize.Fade.Factory',
		'Uize.Curve.Rubber',
		'Uize.Curve.Mod',
		'Uize.Widgets.Container.Widget',
		'Uize.Widgets.Button.Widget'
	],
	function () {
		'use strict';

		/*** create the example page widget ***/
			var page = window.page = UizeSite.Page.Example ({evaluator:function (code) {eval (code)}});

		/*** configuration variables ***/
			var
				totalFrames = 36,
				frameUrlTemplate =
					'http://www.jeep.com/assets/images/vehicles/2015/cherokee/vlp/mod-exterior-360/frame-[#frame].jpg'
			;

		/*** state variables ***/
			var
				rotation = 0,
				lastFrameNo = -1,
				dragStartRotation
			;

		/*** create the Uize.Widget.Drag instance ***/
			var rotationViewer = page.addChild (
				'rotationViewer',
				Uize.Widget.Drag,
				{
					cancelFade:{duration:5000,curve:Uize.Curve.Rubber.easeOutBounce ()},
					releaseTravel:function (speed) {
						var
							deceleration = 5000, // measured in pixels/s/s
							duration = speed / deceleration
						;
						return {
							duration:duration,
							distance:Math.round (speed * duration / 2),
							curve:function (_value) {return 1 - (_value = 1 - _value) * _value}
						};
					},
					html:function (input) {
						var
							htmlChunks = [],
							frameNodeIdPrefix = input.idPrefix + '-frame'
						;
						for (var frameNo = 0; ++frameNo <= totalFrames;) {
							htmlChunks.push (
								'<img' +
									' id="' + frameNodeIdPrefix + frameNo + '"' +
									' src="' + Uize.substituteInto (frameUrlTemplate,{frame:frameNo}) +'"' +
								'/>'
							);
						}
						return htmlChunks.join ('');
					},
					built:false
				}
			);

		/*** wire up the drag widget with events for updating rotation degree ***/
			function updateRotation (newRotation) {
				rotation = ((newRotation % 360) + 360) % 360;
				var frameNo = 1 + Math.round (rotation / 360 * (totalFrames - 1));
				if (frameNo != lastFrameNo) {
					rotationViewer.showNode ('frame'+ lastFrameNo,false);
					rotationViewer.showNode ('frame'+ (lastFrameNo = frameNo));
				}
			}
			rotationViewer.wire ({
				'Drag Start':function () {dragStartRotation = rotation},
				'Drag Update':function (e) {updateRotation (dragStartRotation - e.source.eventDeltaPos [0] / 2.5)}
			});

		/*** function for animating spin ***/
			function spin (degrees,duration,curve) {
				Uize.Fade.Factory.fade (updateRotation,rotation,rotation + degrees,duration,{quantization:1,curve:curve});
			}

		/*** add the buttons for triggering different spins ***/
			page.addChild ('spinButtons',Uize.Widgets.Container.Widget,{built:false})
				.addChildren (
					{
						clockwise:{
							text:'360 clockwise',
							action:function () {spin (360,2700,Uize.Curve.easeInOutPow (4))}
						},
						counterClockwise:{
							text:'360 counter-clockwise',
							action:function () {spin (-360,2700,Uize.Curve.easeInOutPow (4))}
						},
						threeSpins:{
							text:'3 spins',
							action:function () {spin (1080,4000,Uize.Curve.easeInOutPow (4))}
						},
						withBounce:{
							text:'spin with bounce',
							action:function () {spin (360,2700,Uize.Curve.Rubber.easeOutBounce (5,-2,1.5))}
						},
						withElasticity:{
							text:'spin with elasticity',
							action:function () {spin (360,4000,Uize.Curve.Mod.bend (Uize.Curve.Rubber.easeOutElastic (.1),3))}
						}
					},
					{
						widgetClass:Uize.Widgets.Button.Widget,
						size:'small'
					}
				)
			;

		/*** initialization ***/
			page.wireNode (window,'load',function () {spin (360,2700,Uize.Curve.easeInOutPow (4))});

		/*** wire up the page widget ***/
			page.wireUi ();
	}
);

</script>


</body>
</html>

