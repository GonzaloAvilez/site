{% extends "shop/home.html" %}
{% load staticfiles %}
{% load thumbnail %}
{% load i18n %}
{% load crispy_forms_tags %}
{% load compress %}

{% block title %}{{ block.super }}Virtual Reality{% endblock %}

{% block styles %}
    <style>

    	.list-group{
    		list-style-type: none;
    	}

    	.btn-circle {
		  width: 40px;
		  height: 40px;
		  text-align: center;
		  padding: 6px 0;
		  font-size: 12px;
		  line-height: 1.428571429;
		  border-radius: 20px;
		}

        .buttonControlPanel {
            height: 3em;
            width: 17em;
            margin: 5px 0 5px 0;
            line-height: 2.2em
        }
        button: active {
            transform: scale(.98); -webkit-transform: scale(.98)
        }
        #metalPanel {
            position: absolute;
            right: 0;
            width: 8em;
            top: 3em;
            z-index: 20;
            transition: transform.25s ease-in-out;
            transform: translateX(8em); -webkit-transition: -webkit-transform.25s ease-in-out; -webkit-transform: translateX(8em)
        }
        .metalSelector {
            position: absolute;
            background-color: transparent;
            height: 50px;
            width: 50px;
            top: 20px;
            left: -50px;
            border-top-left-radius: 10px 10px;
            border-bottom-left-radius: 10px 10px;
            z-index: 100
        }
        #clickableTag {
            cursor: hand;
            background-color: transparent
        }
        #metalClickableTag {
            cursor: hand;
            background-color: transparent
        }
        #metalControlsZone {
            width: 100 % ;
            height: 100 % ;
            background-color: transparent;
            color: #888;padding:20px;border-bottom-left-radius:10px 10px}.hidden{display:none}
    </style>
{% endblock styles %}

{% block container %}

  	<div id="container"><br /><br /><br /><br /><br />Generating world...</div>
  	<div class="controllerFlagMaterials" id="metalPanel">
        <div id="metalControlsZone">
				 <ul class="list-group">
 				   <li>
 				   <input class="btn btn-default btn-circle" type="button"  id="button_silver" value="" style="z-index:2; position:relative;background-image: url('https://thumbs.dreamstime.com/b/brushed-metal-steel-aluminum-circular-texture-background-73053324.jpg');"></li>
  				  <li >
  				  <input  class="btn btn-default btn-circle" type="button"  id="button_gold" value="" style="z-index:2; position:relative;background-image: url('https://png.pngtree.com/thumb_back/fw800/back_pic/04/51/60/91585e8da53724d.jpg');"></li>
  				  <li >
  				  <input  class="btn-default btn-circle" type="button"  id="button_black" value="" style="z-index:2; position:relative; background-color:rgba(5,5,5,1);" ></li>
 				 </ul>
        </div>
        <div class="metalSelector"><span class="glyphicon glyphicon-cog" style=" font-size: 30px; color:black; text-align:center;"></span></div>
        <div class="metalSelector" id="metalClickableTag"></div>
    </div>



    		<!--<div><br />(left click: forward, right click: backward)</div>-->
    		<div   class ='moveGUI' style='position: absolute; top: 80px; right: 2px'></div>


	 {% if product3d %}
		<!--<br />{{product3d}} |-->
		<!--	<br />{{product3d.slug}}-->
		<!--	<br /> ||{{product3d.id}}-->
		<!--	<br />||{{product3d.storage3d}}-->
		<!--	<br />||{{product3d.texture3d}}-->
		<!--	<br />||{{product3d.custom_model_js}}-->
		<!--	<br />||{{product3d.custom_model_js.js}}-->
		<!--	<br />||{{ MEDIA_URL }}-->
		<!--	<br />|| {{product3d.storage3d}}-->
		<!--	<br />|| {{product3d.storage3d}}-->
		<!--	<br />||{{MEDIA_URL}}{{textures3d.texture_3d}}-->
  <!--          <br />||{{MEDIA_URL}}{{texture_maps.texture_3d}}-->
	{% endif %}


<!--	<div class="container-fluid">-->
<!--	<textarea  class="form-control" id = "textArea" rows="5" placeholder="Password">-->

<!--		</textarea>-->
<!--	    <button class=" btn-primary btn-lg center-block" type="button" value="save" id="save">Generate code file</button>-->
<!--    </div>-->



	<!-- {{product3d.form}} -->
<!--	<div class="container-fluid" >-->
<!--	  <form  enctype="multipart/form-data" method="post" >-->
<!--		<div >-->
<!--		{% csrf_token %}-->
<!--		{% crispy form %}-->
<!--	  </form>-->
<!--	</div>-->

{% endblock container %}


{% block scripts %}

{% compress js %}
    <script src="{% static 'threex/build/three.js' %}"></script>



    <!-- script to save custom code for each model in webgl render -->
    <script src="{% static 'site/js/text_as_file.js' %}"></script>
{% endcompress %}

    <script src="{{product3d.storage3d.url}}"></script>
    <script src="{{product3d.custom_model_js.url}}"></script>

    <script>
	  var metalPanelIsClosed = true;
    document.getElementById("metalClickableTag").addEventListener("click", function () {
        if (metalPanelIsClosed) {
            metalPanelIsClosed = false;
            metalPanel.style.webkitTransform = "translateX(0px)";
            metalPanel.style.transform = "translateX(0px)";
        } else {
            hidemetalPanel();
        }
    });
    var hidemetalPanel = function () {
    metalPanelIsClosed = true;
    metalPanel.style.webkitTransform = "translateX(8em)";
    metalPanel.style.transform = "translateX(8em)";
    };
    </script>




    <!-- scripts values for globlal variables fom server to read in any ..js folder -->
    <script >
    	var loading_model3d ="{{ MEDIA_URL }}{{product3d.storage3d}}"
    	var custom_file = "{{product3d.name}}"
    	var texture_to_Reflect_path =  "{% static 'site/img/TAXCO.jpg' %}"
    	var map_textures = new THREE.TextureLoader();
        var texture_map =  map_textures.load("{{MEDIA_URL}}{{product3d.texture3d}}");

    </script>
    <script type="text/javascript">
        var button = document.getElementById('save');
    	button.addEventListener('click',SaveTextAsFile);

    </script>

{% compress js %}
    <script>src= "https://code.jquery.com/jquery-2.x-git.min.js"</script>
    <script src="{% static 'threex/dat.gui.min.js' %}"></script>
    <script src="{% static 'threex/build/stats.min.js' %}"></script>
    <script src="{% static 'threex/build/OrbitControls.js' %}"></script>

    <script>

    var  stats;
    var container = $("#container")
    var camera, controls, scene, renderer;
    var clock = new THREE.Clock();

    ;(function(){
    	// TODO backport those 2 in Detector.js
    	var hasGetUserMedia = (navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia) ? true : false
    	var hasMediaStreamTrackSources = navigator.mediaDevices.enumerateDevices() ? true : false
    	var hasWebGL = ( function () { try { var canvas = document.createElement( 'canvas' ); return !! ( window.WebGLRenderingContext && ( canvas.getContext( 'webgl' ) || canvas.getContext( 'experimental-webgl' ) ) ); } catch ( e ) { return false; } } )()

    	if( hasWebGL === false ){
    		alert('your browser doesn\'t support navigator.getUserMedia()')
    	}
    	if( hasMediaStreamTrackSources === false ){
    		alert('your browser doesn\'t support MediaStreamTrack.getSources()')
    	}
    	if( hasGetUserMedia === false ){
    		alert('your browser doesn\'t support navigator.getUserMedia()')
    	}
    })()

    	init(container);
    	animate();

    	function init(container) {

    		container = document.getElementById( 'container' );
    		scene = new THREE.Scene();
    		scene.background = new THREE.Color( 0x000022 );
    	    camera	= new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 1000);
            camera.position.z = 50;  //supports more realistic vision (750 for bracelets)

    // **********************************************************************************************
    //                                  jaguar_bracelet_beadings
    // **********************************************************************************************
            ;(function(){
                // var path="{% static 'site/img/taxco' %}";
                // var extension='.jpg';
                // var urls=[
                //     path + 'posx' + extension, path + 'negx' + extension,
                //     path + 'posy' + extension, path + 'negy' + extension,
                //     path + 'posz' + extension, path + 'negz' + extension,
                //     ];

                // var textureCube_to_Reflect = THREE.ImageUtils.loadTextureCube (urls);

                // var loader_texture = new THREE.TextureLoader();
                // var texture =  loader_texture.load("{% static 'site/json/TextureAtlas_jaguar_beadings.png' %}");


                // Spherical Texture environment
                var geometry = new THREE.SphereBufferGeometry( 70, 60, 40 );
    			geometry.scale( - 1, 1, 1 );
    			var material = new THREE.MeshBasicMaterial( {
    				map: new THREE.TextureLoader().load( "{% static 'site/img/max_jewel_store.jpg' %}" )
    			} );

    			sphere = new THREE.Mesh( geometry, material );
                scene.add(sphere);



    			// loading custom code after editing 3d model

    			 CustomFeatures();

    // load a JSON resource Scene
    // 			var loader = new THREE.ObjectLoader();
    // 			var loading_model3d ="{{ MEDIA_URL }}{{product3d.storage3d}}"
    // 			loader.load(loading_model3d,function ( object ) {
    // 				// var materials = new THREE.MeshStandardMaterial({
    // 				// 					color : 0x591212,
    // 			 //                       emissive   : 0x8e3333,
    // 			 //                       emissiveIntensity : 0.498,
    // 			 //                       roughness : 0.52,
    // 			 //                       metalness: 0.77,
    // 			 //                       shading : THREE.SmoothShading,
    // 			 //                       side : THREE.DoubleSide,
    // 				// });
    // 	           //  console.log(object);
    // 	           //  var object3d = new THREE.Mesh( object,materials );
    // 	                object.rotation.x = 3*Math.PI/2;
    // 	    		    scene.add( object );


    // load JSON Scene


    // 	      var texture_to_Reflect = new THREE.TextureLoader().load( "{% static 'site/img/TAXCO.jpg' %}" );
    // 			texture_to_Reflect.mapping = THREE.SphericalReflectionMapping;

    // 	         var parameters = {
    // 	                             color : 0x82dbff,       //set default value
    // 	                     		opacity: 1.00,
    // 	                     		emissive : 0Xbc1a1a,
    // 	                     		emissiveIntensity : 0.08,
    // 	                     		envMap : true,
    // 	                     		roughness : 0.45,
    // 	                     		metalness : 0.7,
    // 	                     		smooth : true,
    // 	                     	}
    // 		    var front_materials = new THREE.MeshStandardMaterial({
    // 		                    color : parameters.color,                           //as a defalult value
    // 		                    emissive   : parameters.emissive,
    // 		                    emissiveIntensity : parameters.emissiveIntensity,
    // 		                    roughness : parameters.roughness,
    // 		                    metalness: parameters.metalness,
    // 		                    // envMap     : textureCube_to_Reflect,
    // 		                    // side : THREE.BackSide, retifica render de objecto inverso en anillo.json
    // 		                    side : THREE.FrontSide, // BackSide and DoubleSide
    // 		                    opacity : 0.5,
    // 		                    shading : THREE.SmoothShading, // or THREE.FlatShanding
    // 		                    transparent: true,
    // 		})
    //          var back_materials = new THREE.MeshStandardMaterial({
    //                              color : parameters.color,                           //as a defalult value
    //                              emissive   : parameters.emissive,
    //                              emissiveIntensity : parameters.emissiveIntensity,
    //                              roughness : parameters.roughness,
    //                              metalness: parameters.metalness,
    //                              // envMap     : textureCube_to_Reflect,
    //                              // side : THREE.BackSide, retifica render de objecto inverso en anillo.json
    //                              side : THREE.BackSide, // BackSide and DoubleSide
    //                              opacity : parameters.opacity,
    //                              shading : THREE.SmoothShading, // or THREE.FlatShanding
    //                              // transparent: true,
    //                       })

    //         var  silver_materials = new THREE.MeshStandardMaterial( {
    //                                          color : parameters.color,                           //as a defalult value
    //                                          emissive   : parameters.emissive,
    //                                          emissiveIntensity : parameters.emissiveIntensity,
    //                                          roughness : parameters.roughness,
    //                                          metalness: parameters.metalness,
    //                                          envMap     : texture_to_Reflect,
    //                                          shading : THREE.SmoothShading,
    //                                          side : THREE.DoubleSide,
    //                                          map : texture_map,
    //                                      } );
    //          //load JSON object or scene
    //          var loader = new THREE.ObjectLoader();
    //          var loading_model3d ="{{ MEDIA_URL }}{{product3d.storage3d}}"
    //          loader.load(loading_model3d,function ( object ) {
    //                      console.log (object); //only as a debug mode default

    //                      var leopardos = object.getObjectByName("leopard_head");
    //                      var pulsera = object.getObjectByName("bracelet");
    //                      pulsera.material.metalness = 0.0;
    //                      pulsera.material.roughness = 1.0;
    //                      pulsera.material.shininess = 0.0;
    //                      pulsera.material.bumpScale = 0.4;
    //                      console.log(leopardos);
    //                      console.log(pulsera);
    //                      leopardos.traverse(function(child) {     //change hole values for materials inside json  and set child.material
    //                          if (child instanceof THREE.Mesh) {
    //                              child.material = silver_materials;
    //                              child.geometry.computeVertexNormals();
    //                             //  child.scale.set(1,1,1).multiplyScalar(1/4);

    //                          }
    //                      });
    //                      // leopardos.scale.set(1,1,1).multiplyScalar(1/6);

    //                     //  object.scale.set(1,1,1).multiplyScalar(1/4);
    //                     //  leopardos.rotation.y = Math.PI;
    //                     //  leopardos.rotation.z = Math.PI;
    //                     //  leopardos.rotation.x = Math.PI/12;
    //                     //  object.rotation.y = 3*Math.PI/2;
    //                     //  object.rotation.z = 11*Math.PI/12;
    //                      scene.add(object);
    //                      scene.add(leopardos);









    // 				var gui = new dat.GUI({
    // 				autoPlace: false,
    // 				width: 300
    // 				});

    // 				var customContainer = $('.moveGUI').append($(gui.domElement));
    // 				gui.addFolder("material");
    // 				  gui.addColor(parameters, 'color').onChange(function(e) {
    // 				    silver_materials.color = new THREE.Color(e);
    // 				    var last_color = console.log('custom_color: ' + e);


    // 				});
    // 				gui.addColor(parameters, 'emissive').onChange(function(e){
    // 				silver_materials.emissive = new THREE.Color(e);
    // 				console.log('custom_emissive: ' + e);

    // 				})
    // 				gui.add(parameters,'opacity',0, 1).onChange(function(){
    // 			    silver_materials.opacity =  parameters.opacity;
    // 				})
    // 				gui.add(parameters, 'emissiveIntensity',0,1).onChange(function(){
    // 					silver_materials.emissiveIntensity = parameters.emissiveIntensity;
    // 				})
    // 				gui.add(parameters,'roughness',0,1).onChange(function(){
    // 					silver_materials.roughness = parameters.roughness;
    // 				})
    // 				gui.add(parameters,'metalness',0,1).onChange(function(){
    // 					silver_materials.metalness = parameters.metalness;
    // 				})
    // 				gui.add(parameters,'envMap',0,1).onChange(function(envmap){
    // 					if(this.checked ) {silver_materials.envMap = parameters.envMap;}
    // 					else {silver_materials.envMap = null;}
    // 				})
    // 				gui.open();
    // 				console.log(gui);
    // 			});



    		})()

                    //lights for tiger´s eye effect
        //             var h_light = 2;
        //             var w_light = 100;
        //             var light_color = 0xf5b700;
        //             var rectLight = new THREE.RectAreaLight( light_color, undefined, h_light, w_light );
        //             rectLight.intensity = 600;
    				// rectLight.position.set( 10, -10, -15 );
        //             scene.add( rectLight );

        //              var rectLight2 = new THREE.RectAreaLight( light_color, undefined, h_light, w_light );
        //             rectLight2.intensity = 300;
    				// rectLight2.position.set( -5, 0, -25 );
        //             scene.add( rectLight2 );



    // ************************************************************************************************
    //                                  Global-Scene complements
    // ************************************************************************************************
    				var ambientLight = new THREE.AmbientLight( 0xffffff, 0.2 );
    				scene.add( ambientLight );
                    var spotLight	= new THREE.SpotLight( 0xffffff );
                    spotLight.position.set( 20, 40, 60 );
                    console.log(spotLight);
                    scene.add( spotLight );

    				var directionalLight = new THREE.DirectionalLight( 0xffffff, 1 );
    				directionalLight.position.set( 10, 10, 3.5 ).normalize();
    				scene.add( directionalLight );

    				var spotLight	= new THREE.SpotLight( 0xffffff );
    				spotLight.position.set( -5, 5, -4 );
                    scene.add( spotLight );
    				// var directionalLight = new THREE.DirectionalLight( 0xffffff, 1 );
    				// directionalLight.position.set( -10, -10, -3.5 ).normalize(); //(x,y,z)
    				// scene.add( directionalLight );

    				renderer = new THREE.WebGLRenderer();
    				renderer.setPixelRatio( window.devicePixelRatio );
    				renderer.setSize( window.innerWidth, window.innerHeight );
    				container.innerHTML = "";
    				container.appendChild( renderer.domElement );
    				window.addEventListener( 'resize', onWindowResize, false );

                    //controls
    				var controls = new THREE.OrbitControls( camera, renderer.domElement );
                    controls.enableRotate = true;
                    controls.enableZoom = true;
                    controls.update();
    				renderer.gammaFactor = 1.2;
                    renderer.gammaOutput = true;
                    renderer.gammaInput = true;
    			}

    			function onWindowResize() {
    				camera.aspect = window.innerWidth / window.innerHeight;
    				camera.updateProjectionMatrix();
    				renderer.setSize( window.innerWidth, window.innerHeight );
    			}
    			function animate() {
    				requestAnimationFrame( animate );
    				render();
    			}
    			function render() {
    				renderer.render( scene, camera );
    			}
    </script>
    <script>
        $('.container').empty();            //Hidde footer container from base.html in order to resize correctly Screens
    </script>

{% endcompress %}


{% endblock scripts %}